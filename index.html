<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RCM CEO Suite</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2563eb; /* Corporate Blue */
            --secondary: #10b981; /* Success Green */
            --accent: #f59e0b; /* Warning Orange */
            --dark: #1e293b;
            --light: #f1f5f9;
            --white: #ffffff;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        body { background-color: var(--light); color: var(--dark); font-family: 'Inter', sans-serif; padding-bottom: 90px; }
        
        /* HEADER (Gradient Modern) */
        .app-header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white; padding: 20px 20px 30px 20px;
            border-bottom-left-radius: 25px; border-bottom-right-radius: 25px;
            box-shadow: var(--shadow); position: relative; z-index: 10;
        }
        .user-profile { display: flex; align-items: center; justify-content: space-between; }
        .user-info h5 { margin: 0; font-weight: 700; letter-spacing: 0.5px; }
        .user-info small { opacity: 0.8; font-size: 0.85em; }
        .streak-badge { background: rgba(255,255,255,0.2); padding: 5px 12px; border-radius: 20px; font-weight: bold; font-size: 0.8em; display: flex; align-items: center; backdrop-filter: blur(5px); }
        
        /* DASHBOARD CARDS (Floating) */
        .dash-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 0 20px; margin-top: -25px; position: relative; z-index: 20; }
        .dash-card { background: white; padding: 15px; border-radius: 16px; box-shadow: var(--shadow); text-align: center; transition: transform 0.2s; }
        .dash-card:active { transform: scale(0.98); }
        .dash-card h3 { margin: 0; font-weight: 700; color: var(--primary); }
        .dash-card small { color: #64748b; font-size: 0.75em; text-transform: uppercase; letter-spacing: 0.5px; }
        
        /* SECTION STYLES */
        .section-view { display: none; padding-top: 20px; animation: fadeIn 0.3s ease-in-out; }
        .section-view.active-view { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .content-container { padding: 0 20px; }
        
        /* LIST & FILTERS */
        .filter-scroll { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; }
        .filter-chip { background: white; border: 1px solid #e2e8f0; padding: 6px 16px; border-radius: 20px; font-size: 0.85em; white-space: nowrap; color: #64748b; font-weight: 600; cursor: pointer; }
        .filter-chip.active { background: var(--primary); color: white; border-color: var(--primary); }
        
        .client-card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.02); border: 1px solid #f1f5f9; display: flex; justify-content: space-between; align-items: center; }
        .client-left { display: flex; align-items: center; }
        .client-avatar { width: 45px; height: 45px; border-radius: 12px; background: #e0e7ff; color: var(--primary); display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 12px; font-size: 1.2em; object-fit: cover;}
        
        /* BOTTOM NAV (Floating) */
        .bottom-nav {
            position: fixed; bottom: 20px; left: 20px; right: 20px;
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px);
            border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            display: flex; justify-content: space-around; padding: 15px; z-index: 1000;
            border: 1px solid rgba(255,255,255,0.5);
        }
        .nav-item { color: #94a3b8; text-align: center; text-decoration: none; font-size: 0.7em; transition: 0.3s; }
        .nav-item i { font-size: 1.4em; display: block; margin-bottom: 3px; }
        .nav-item.active { color: var(--primary); transform: translateY(-3px); }
        
        /* FAB BUTTON */
        .fab-btn {
            position: fixed; bottom: 90px; right: 20px;
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white; width: 55px; height: 55px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5em; box-shadow: 0 4px 15px rgba(37, 99, 235, 0.4);
            z-index: 999; border: none; transition: 0.3s;
        }
        .fab-btn:active { transform: scale(0.9); }

        /* MODAL POLISH */
        .modal-content { border-radius: 20px; border: none; }
        .form-control { border-radius: 10px; padding: 10px 15px; border: 1px solid #e2e8f0; background: #f8fafc; }
        .form-control:focus { background: white; border-color: var(--primary); box-shadow: none; }
        
        /* TEAM TAB */
        .team-card { background: white; border-left: 4px solid var(--accent); padding: 15px; border-radius: 10px; margin-bottom: 10px; box-shadow: var(--shadow); }
    </style>
</head>
<body>

    <header class="app-header">
        <div class="user-profile">
            <div class="user-info">
                <h5>Hello, Leader üëã</h5>
                <small id="currentDate">Mon, 12 Dec</small>
            </div>
            <div class="streak-badge">
                üî• <span id="streakCount" class="ms-1">0 Day</span>
            </div>
        </div>
    </header>

    <div class="dash-grid">
        <div class="dash-card">
            <h3><span id="statTotalClients">0</span></h3>
            <small>Total Clients</small>
        </div>
        <div class="dash-card">
            <h3 class="text-success">‚Çπ<span id="statTotalSale">0</span></h3>
            <small>Total Revenue</small>
        </div>
    </div>

    <div class="container content-container mt-4">

        <div id="view-home" class="section-view active-view">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h6 class="fw-bold m-0 text-muted">MY LEADS</h6>
                <button class="btn btn-sm btn-light text-primary" onclick="exportToExcel()"><i class="fas fa-file-excel"></i> Excel</button>
            </div>
            
            <div class="filter-scroll mb-3">
                <div class="filter-chip active" onclick="filterList('all', this)">All</div>
                <div class="filter-chip" onclick="filterList('pending', this)">‚è≥ Pending</div>
                <div class="filter-chip" onclick="filterList('hot', this)">üî• Hot</div>
                <div class="filter-chip" onclick="filterList('warm', this)">ü§î Warm</div>
            </div>

            <div id="clientListContainer"></div>
            <div class="text-center text-muted small mt-5" id="emptyState" style="display:none;">
                <i class="fas fa-box-open fa-3x mb-3 opacity-25"></i><br>No data found. Start adding!
            </div>
        </div>

        <div id="view-tasks" class="section-view">
            <h6 class="fw-bold mb-3 text-muted">TODAY'S ACTIONS</h6>
            <div id="taskListContainer"></div>
        </div>

        <div id="view-team" class="section-view">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h6 class="fw-bold m-0 text-muted">MY DOWNLINE</h6>
                <button class="btn btn-sm btn-primary rounded-pill" onclick="new bootstrap.Modal(document.getElementById('addTeamModal')).show()">+ Add Member</button>
            </div>
            <div id="teamListContainer"></div>
        </div>

        <div id="view-tools" class="section-view">
            <h6 class="fw-bold mb-3 text-muted">TOOLS & SETTINGS</h6>
            <div class="card p-3 mb-3" onclick="downloadBackup()">
                <div class="d-flex align-items-center">
                    <div class="bg-light p-3 rounded-circle me-3"><i class="fas fa-download text-primary"></i></div>
                    <div><h6 class="m-0">Backup Data</h6><small class="text-muted">Save JSON file</small></div>
                </div>
            </div>
            <div class="card p-3 mb-3">
                <label class="d-flex align-items-center w-100 m-0">
                    <div class="bg-light p-3 rounded-circle me-3"><i class="fas fa-upload text-success"></i></div>
                    <div class="flex-grow-1"><h6 class="m-0">Restore Data</h6><small class="text-muted">Load from file</small></div>
                    <input type="file" style="display:none" onchange="importBackup(this)">
                </label>
            </div>
            <div class="card p-3 mb-3" onclick="exportToExcel()">
                <div class="d-flex align-items-center">
                    <div class="bg-light p-3 rounded-circle me-3"><i class="fas fa-file-excel text-success"></i></div>
                    <div><h6 class="m-0">Export Report</h6><small class="text-muted">Save as Excel</small></div>
                </div>
            </div>
        </div>

    </div>

    <button class="fab-btn" onclick="openAddModal()"><i class="fas fa-plus"></i></button>

    <div class="modal fade" id="addModal" tabindex="-1">
        <div class="modal-dialog modal-fullscreen-sm-down">
            <div class="modal-content">
                <div class="modal-header bg-light"><h5 class="modal-title fw-bold">New Entry</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form id="addForm">
                        <div class="text-center mb-3">
                            <input type="file" id="meetingPhoto" class="d-none" accept="image/*" capture="environment" onchange="handlePhoto(this)">
                            <div onclick="document.getElementById('meetingPhoto').click()" class="border rounded p-3 bg-light d-inline-block" style="cursor:pointer;">
                                <img id="photoPreview" src="https://via.placeholder.com/80?text=Photo" style="width:80px;height:80px;object-fit:cover;border-radius:10px;">
                                <div class="small mt-1 text-muted"><i class="fas fa-camera"></i> GPS Photo</div>
                            </div>
                            <div id="photoStatus" class="small text-success fw-bold mt-1"></div>
                        </div>
                        
                        <div class="row g-2">
                            <div class="col-6"><input type="text" class="form-control" id="cName" placeholder="Name" required></div>
                            <div class="col-6"><input type="tel" class="form-control" id="cPhone" placeholder="Mobile"></div>
                            <div class="col-12"><select class="form-select" id="cType"><option value="Hot">üî• Hot</option><option value="Warm">ü§î Warm</option><option value="Cold">‚ùÑÔ∏è Cold</option></select></div>
                            <div class="col-12">
                                <div class="input-group">
                                    <select class="form-select" id="cProd" onchange="fillPrice()"><option value="">Select Product...</option></select>
                                    <input type="number" class="form-control" id="cPrice" placeholder="‚Çπ" style="max-width:80px;">
                                </div>
                            </div>
                            <div class="col-12"><label class="small text-muted ms-1">Next Follow-up</label><input type="date" class="form-control" id="cDate"></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-primary w-100 py-2 rounded-3" onclick="saveClient()">Save Entry</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="addTeamModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Add Team Member</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><input type="text" id="tName" class="form-control mb-2" placeholder="Name"><input type="text" id="tCity" class="form-control mb-2" placeholder="City"><input type="tel" id="tPhone" class="form-control mb-2" placeholder="Mobile"><button class="btn btn-success w-100" onclick="saveTeam()">Add</button></div></div></div></div>

    <div class="bottom-nav">
        <a class="nav-item active" onclick="switchTab('view-home', this)"><i class="fas fa-home"></i>Home</a>
        <a class="nav-item" onclick="switchTab('view-tasks', this)"><i class="fas fa-calendar-check"></i>Tasks</a>
        <a class="nav-item" onclick="switchTab('view-team', this)"><i class="fas fa-users"></i>Team</a>
        <a class="nav-item" onclick="switchTab('view-tools', this)"><i class="fas fa-cog"></i>Tools</a>
    </div>

    <canvas id="photoCanvas" style="display:none;"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // --- DATA & CONFIG ---
        const SHEET_ID = "1eR5THz-4AV3HkfnNJ5Un48ksz0I0jrepJSED3qHFg6k";
        let processedPhotoData = null; 
        
        // --- INIT ---
        document.getElementById('currentDate').innerText = new Date().toLocaleDateString('en-IN', {weekday:'short', day:'numeric', month:'short'});
        document.addEventListener('DOMContentLoaded', () => { loadData(); updateStats(); checkStreak(); loadProducts(); });

        // --- CORE FUNCTIONS ---
        function loadData(filter = 'all') {
            const list = document.getElementById('clientListContainer');
            const clients = JSON.parse(localStorage.getItem('rcmClients') || "[]");
            list.innerHTML = '';
            
            let filtered = clients;
            if(filter === 'pending') filtered = clients.filter(c => c.status === 'Pending');
            else if(filter === 'hot') filtered = clients.filter(c => c.leadType === 'Hot');
            else if(filter === 'warm') filtered = clients.filter(c => c.leadType === 'Warm');

            if(filtered.length === 0) document.getElementById('emptyState').style.display = 'block';
            else document.getElementById('emptyState').style.display = 'none';

            filtered.forEach(c => {
                let img = c.photo ? c.photo : null;
                let avatar = img ? `<img src="${img}" class="client-avatar">` : `<div class="client-avatar">${c.name.charAt(0)}</div>`;
                
                list.innerHTML += `
                <div class="client-card">
                    <div class="client-left">
                        ${avatar}
                        <div>
                            <h6 class="m-0 fw-bold">${c.name}</h6>
                            <small class="text-muted">${c.product} ‚Ä¢ ‚Çπ${c.amount}</small>
                        </div>
                    </div>
                    <div>
                        <a href="tel:${c.phone}" class="btn btn-sm btn-light text-primary rounded-circle"><i class="fas fa-phone"></i></a>
                        <button onclick="deleteClient(${c.id})" class="btn btn-sm btn-light text-danger rounded-circle"><i class="fas fa-trash"></i></button>
                    </div>
                </div>`;
            });
            loadTasks();
        }

        function loadTasks() {
            const list = document.getElementById('taskListContainer'); list.innerHTML = '';
            const clients = JSON.parse(localStorage.getItem('rcmClients') || "[]");
            const today = new Date().toISOString().split('T')[0];
            
            let tasks = clients.filter(c => c.status === 'Pending').sort((a,b) => new Date(a.nextFollowUp) - new Date(b.nextFollowUp));
            
            tasks.forEach(c => {
                let color = c.nextFollowUp <= today ? 'danger' : 'primary';
                let txt = c.nextFollowUp <= today ? 'Today/Late' : c.nextFollowUp;
                list.innerHTML += `
                <div class="client-card" style="border-left: 4px solid var(--${color})">
                    <div><h6 class="m-0">${c.name}</h6><small class="text-${color}">${txt}</small></div>
                    <button class="btn btn-sm btn-success rounded-pill px-3" onclick="markDone(${c.id})">Done</button>
                </div>`;
            });
        }

        function saveClient() {
            let name = document.getElementById('cName').value;
            if(!name) { alert("Name required"); return; }
            
            let client = {
                id: Date.now(),
                name: name,
                phone: document.getElementById('cPhone').value,
                leadType: document.getElementById('cType').value,
                product: document.getElementById('cProd').value,
                amount: document.getElementById('cPrice').value || 0,
                nextFollowUp: document.getElementById('cDate').value || new Date().toISOString().split('T')[0],
                status: 'Pending',
                photo: processedPhotoData,
                dateAdded: new Date().toLocaleDateString()
            };
            
            let db = JSON.parse(localStorage.getItem('rcmClients') || "[]");
            db.unshift(client);
            localStorage.setItem('rcmClients', JSON.stringify(db));
            
            // Update Streak
            let today = new Date().toDateString();
            localStorage.setItem('lastWorkDate', today);
            checkStreak();

            bootstrap.Modal.getInstance(document.getElementById('addModal')).hide();
            document.getElementById('addForm').reset();
            processedPhotoData = null;
            document.getElementById('photoPreview').src = "https://via.placeholder.com/80?text=Photo";
            document.getElementById('photoStatus').innerText = "";
            
            loadData(); updateStats();
        }

        // --- TEAM LOGIC ---
        function saveTeam() {
            let member = {
                name: document.getElementById('tName').value,
                city: document.getElementById('tCity').value,
                phone: document.getElementById('tPhone').value
            };
            let team = JSON.parse(localStorage.getItem('rcmTeam') || "[]");
            team.push(member);
            localStorage.setItem('rcmTeam', JSON.stringify(team));
            bootstrap.Modal.getInstance(document.getElementById('addTeamModal')).hide();
            loadTeam();
        }
        function loadTeam() {
            const div = document.getElementById('teamListContainer'); div.innerHTML = '';
            let team = JSON.parse(localStorage.getItem('rcmTeam') || "[]");
            if(team.length === 0) div.innerHTML = "<div class='text-center text-muted mt-4'>No team members yet.</div>";
            team.forEach(m => {
                div.innerHTML += `<div class="team-card"><strong>${m.name}</strong><br><small>${m.city} ‚Ä¢ ${m.phone}</small></div>`;
            });
        }

        // --- UTILS ---
        function updateStats() {
            let db = JSON.parse(localStorage.getItem('rcmClients') || "[]");
            document.getElementById('statTotalClients').innerText = db.length;
            let total = db.reduce((sum, c) => sum + parseInt(c.amount||0), 0);
            document.getElementById('statTotalSale').innerText = total.toLocaleString();
        }

        function checkStreak() {
            let lastDate = localStorage.getItem('lastWorkDate');
            let today = new Date().toDateString();
            let streak = parseInt(localStorage.getItem('streakCount') || 0);
            
            if (lastDate === today) {
                // Already counted
            } else {
                let yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1);
                if (lastDate === yesterday.toDateString()) {
                    streak++; // Continued streak
                } else if (!lastDate) {
                    streak = 1; // First day
                } else {
                    streak = 1; // Broken streak
                }
                if(lastDate) localStorage.setItem('streakCount', streak); // Update only if action done
            }
            document.getElementById('streakCount').innerText = streak + " Day Streak";
        }

        function exportToExcel() {
            let db = JSON.parse(localStorage.getItem('rcmClients') || "[]");
            let csvContent = "data:text/csv;charset=utf-8,Name,Phone,Product,Amount,Status,Date\n";
            db.forEach(c => {
                csvContent += `${c.name},${c.phone},${c.product},${c.amount},${c.status},${c.dateAdded}\n`;
            });
            let encodedUri = encodeURI(csvContent);
            let link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "RCM_Data.csv");
            document.body.appendChild(link);
            link.click();
        }

        // --- GPS & PHOTO ---
        function handlePhoto(input) {
            const file = input.files[0]; if(!file) return;
            document.getElementById('photoStatus').innerText = "Locating...";
            navigator.geolocation.getCurrentPosition(pos => processImage(file, `Loc: ${pos.coords.latitude.toFixed(2)},${pos.coords.longitude.toFixed(2)}`), 
            err => processImage(file, "No GPS"));
        }
        function processImage(file, loc) {
            const reader = new FileReader(); reader.onload = e => {
                const img = new Image(); img.onload = () => {
                    const cvs = document.getElementById('photoCanvas'); const ctx = cvs.getContext('2d');
                    cvs.width = 400; cvs.height = (img.height/img.width)*400;
                    ctx.drawImage(img, 0,0, cvs.width, cvs.height);
                    ctx.fillStyle="rgba(0,0,0,0.5)"; ctx.fillRect(0,cvs.height-20,cvs.width,20);
                    ctx.fillStyle="white"; ctx.font="10px Arial"; ctx.fillText(loc, 5, cvs.height-5);
                    processedPhotoData = cvs.toDataURL('image/jpeg', 0.5);
                    document.getElementById('photoPreview').src = processedPhotoData;
                    document.getElementById('photoStatus').innerText = "Attached";
                }; img.src = e.target.result;
            }; reader.readAsDataURL(file);
        }

        // --- PRODUCTS ---
        function loadProducts() {
            const dd = document.getElementById('cProd');
            fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv`).then(r=>r.text()).then(csv=>{
                dd.innerHTML = '<option value="">Select Product</option>';
                csv.split('\n').forEach(r => {
                    let cols = r.replace(/"/g,'').split(',');
                    if(cols[0] && cols[0].length>2) {
                        let opt = document.createElement('option');
                        opt.value = cols[0]; opt.dataset.price = cols[1]||0; opt.text = cols[0];
                        dd.add(opt);
                    }
                });
            }).catch(()=>{});
        }
        function fillPrice() {
            const dd = document.getElementById('cProd');
            const price = dd.options[dd.selectedIndex].dataset.price;
            if(price) document.getElementById('cPrice').value = price;
        }

        // --- NAVIGATION & UTILS ---
        function switchTab(viewId, el) {
            document.querySelectorAll('.section-view').forEach(d => d.classList.remove('active-view'));
            document.getElementById(viewId).classList.add('active-view');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
            if(viewId === 'view-tasks') loadTasks();
            if(viewId === 'view-team') loadTeam();
        }
        function filterList(type, el) {
            document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            loadData(type);
        }
        function openAddModal() { new bootstrap.Modal(document.getElementById('addModal')).show(); }
        function deleteClient(id) { if(confirm("Delete?")) { let db=JSON.parse(localStorage.getItem('rcmClients')); db=db.filter(x=>x.id!==id); localStorage.setItem('rcmClients',JSON.stringify(db)); loadData(); updateStats(); } }
        function markDone(id) { let db=JSON.parse(localStorage.getItem('rcmClients')); let i=db.findIndex(x=>x.id===id); if(i>-1) db[i].status='Done'; localStorage.setItem('rcmClients',JSON.stringify(db)); loadTasks(); }
        function downloadBackup() { const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([localStorage.getItem('rcmClients')],{type:"application/json"})); a.download="Backup.json"; a.click(); }
        function importBackup(i) { const r=new FileReader(); r.onload=e=>{ if(confirm("Restore data?")){localStorage.setItem('rcmClients', e.target.result); location.reload();} }; r.readAsText(i.files[0]); }
    </script>
</body>
</html>
