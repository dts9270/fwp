<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RCM Ultimate</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --saffron: #FF9933; --white: #ffffff; --green: #138808; --chakra: #000080; --bg: #f0f2f5;
        }
        body { background-color: var(--bg); font-family: 'Poppins', sans-serif; padding-bottom: 90px; }
        
        /* üáÆüá≥ HEADER */
        .app-header { 
            background: linear-gradient(135deg, var(--saffron), var(--white), var(--green));
            padding: 15px 20px; border-bottom: 4px solid var(--chakra);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15); position: sticky; top: 0; z-index: 1000;
        }
        .header-content {
            background: rgba(255, 255, 255, 0.9); padding: 8px 15px; border-radius: 30px;
            display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--chakra);
        }
        .header-title { font-weight: 800; color: var(--chakra); margin: 0; font-size: 1.1em; }

        /* TARGET METER */
        .target-card {
            background: var(--chakra); color: white; border-radius: 15px; padding: 20px;
            margin-bottom: 20px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            position: relative; overflow: hidden;
        }
        .progress-bg { background: rgba(255,255,255,0.2); height: 10px; border-radius: 5px; margin-top: 10px; }
        .progress-fill { background: var(--green); height: 100%; width: 0%; border-radius: 5px; transition: width 1s; }
        .target-edit { position: absolute; top: 10px; right: 10px; color: rgba(255,255,255,0.7); cursor: pointer; }

        /* BIRTHDAY ALERT */
        .bday-alert {
            background: linear-gradient(45deg, #ff9a9e, #fad0c4); color: #880e4f;
            padding: 10px; border-radius: 10px; margin-bottom: 15px; display: none;
            align-items: center; justify-content: space-between; border: 1px solid #ffcdd2;
        }

        /* PROMO CARDS */
        .promo-card {
            background: white; padding: 15px; border-radius: 12px; margin-bottom: 10px;
            border-left: 5px solid var(--chakra); box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .btn-copy { background: #f0f0f0; border: none; padding: 5px 10px; border-radius: 5px; font-size: 0.8em; }

        /* CARDS & UI */
        .task-card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 10px; border-left: 5px solid var(--saffron); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .client-card { background: white; padding: 12px; margin-bottom: 8px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #e0e0e0; }
        
        .section-view { display: none; padding-top: 15px; } .section-view.active-view { display: block; }
        
        /* NAV & FAB */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 10px; border-top: 3px solid var(--saffron); z-index: 1000; }
        .nav-item { text-align: center; color: #888; text-decoration: none; font-size: 0.75em; }
        .nav-item.active { color: var(--chakra); font-weight: bold; } .nav-item i { font-size: 1.5em; display: block; }
        .fab-btn { position: fixed; bottom: 85px; right: 20px; background: var(--chakra); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.8em; z-index: 999; box-shadow: 0 4px 10px rgba(0,0,0,0.3); border: 2px solid white; }

        /* PRINT */
        @media print { .no-print { display: none !important; } .print-area { display: block !important; } }
        .print-area { display: none; background: white; padding: 20px; }
        .report-table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.9em; }
        .report-table th, .report-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    </style>
</head>
<body>

    <header class="app-header no-print">
        <div class="header-content">
            <h5 class="header-title"><i class="fas fa-gem"></i> RCM Ultimate</h5>
            <small class="fw-bold text-success" id="rankBadge">Beginner</small>
        </div>
    </header>

    <div class="container px-3 no-print">
        
        <div id="view-home" class="section-view active-view">
            
            <div id="bdayAlert" class="bday-alert shadow-sm">
                <div><i class="fas fa-birthday-cake me-2"></i> Birthday Alert!</div>
                <div id="bdayNames" class="fw-bold"></div>
            </div>

            <div class="target-card">
                <i class="fas fa-edit target-edit" onclick="setTarget()"></i>
                <h6 class="opacity-75 mb-1">THIS MONTH TARGET</h6>
                <h2 class="fw-bold mb-0">‚Çπ<span id="currentSale">0</span> / <span id="targetAmount">0</span></h2>
                <div class="progress-bg"><div class="progress-fill" id="targetBar"></div></div>
                <small class="mt-2 d-block text-warning" id="targetMsg">Keep Pushing!</small>
            </div>

            <h6 class="text-muted fw-bold mb-3">üìÖ ‡§Ü‡§ú‡§ö‡•á ‡§ï‡§æ‡§Æ (Today's Tasks)</h6>
            <div id="taskListContainer"></div>
        </div>

        <div id="view-promo" class="section-view">
            <h6 class="text-muted fw-bold mb-3">üì¢ Marketing Scripts (Ready Messages)</h6>
            
            <div class="promo-card">
                <div class="d-flex justify-content-between mb-2">
                    <strong class="text-primary">üëã Welcome Message</strong>
                    <button class="btn-copy" onclick="copyText('msg1')">Copy</button>
                </div>
                <p class="small text-muted m-0" id="msg1">‡§®‡§Æ‡§∏‡•ç‡§ï‡§æ‡§∞! üôè ‡§Æ‡•Ä ‡§¶‡•Ä‡§™‡§ï, RCM ‡§¨‡§ø‡§ú‡§®‡•á‡§∏ ‡§™‡§æ‡§∞‡•ç‡§ü‡§®‡§∞. ‡§Ü‡§™‡§≤‡•ç‡§Ø‡§æ ‡§Ü‡§∞‡•ã‡§ó‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§â‡§§‡•ç‡§§‡§Æ ‡§Ü‡§£‡§ø ‡§∂‡•Å‡§¶‡•ç‡§ß ‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü‡•ç‡§∏ ‡§Ü‡§Æ‡§ö‡•ç‡§Ø‡§æ‡§ï‡§°‡•á ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§Ü‡§π‡•á‡§§. ‡§è‡§ï‡§¶‡§æ ‡§®‡§ï‡•ç‡§ï‡•Ä ‡§∏‡•á‡§µ‡§æ ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§ö‡•Ä ‡§∏‡§Ç‡§ß‡•Ä ‡§¶‡•ç‡§Ø‡§æ. ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!</p>
                <button class="btn btn-sm btn-success w-100 mt-2" onclick="shareWhatsapp('msg1')"><i class="fab fa-whatsapp"></i> Share</button>
            </div>

            <div class="promo-card">
                <div class="d-flex justify-content-between mb-2">
                    <strong class="text-danger">üî• Special Offer</strong>
                    <button class="btn-copy" onclick="copyText('msg2')">Copy</button>
                </div>
                <p class="small text-muted m-0" id="msg2">üéâ ‡§ñ‡•Å‡§∂‡§ñ‡§¨‡§∞! RCM ‡§ö‡•ç‡§Ø‡§æ ‡§π‡•á‡§≤‡•ç‡§• ‡§ó‡§æ‡§∞‡•ç‡§° ‡§ë‡§á‡§≤ ‡§Ü‡§£‡§ø ‡§®‡•ç‡§Ø‡•Ç‡§ü‡•ç‡§∞‡•Ä‡§ö‡§æ‡§∞‡•ç‡§ú ‡§µ‡§∞ ‡§ú‡§¨‡§∞‡§¶‡§∏‡•ç‡§§ ‡§ë‡§´‡§∞ ‡§∏‡•Å‡§∞‡•Ç ‡§Ü‡§π‡•á. ‡§∏‡•ç‡§ü‡•â‡§ï ‡§∏‡§Ç‡§™‡§£‡•ç‡§Ø‡§æ‡§Ü‡§ß‡•Ä ‡§Ü‡§ú‡§ö ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡§∞‡§æ! üõçÔ∏è</p>
                <button class="btn btn-sm btn-success w-100 mt-2" onclick="shareWhatsapp('msg2')"><i class="fab fa-whatsapp"></i> Share</button>
            </div>

            <div class="promo-card">
                <div class="d-flex justify-content-between mb-2">
                    <strong class="text-primary">ü§ù Meeting Invite</strong>
                    <button class="btn-copy" onclick="copyText('msg3')">Copy</button>
                </div>
                <p class="small text-muted m-0" id="msg3">‡§∏‡§∞/‡§Æ‡•Ö‡§°‡§Æ, ‡§è‡§ï ‡§ú‡§¨‡§∞‡§¶‡§∏‡•ç‡§§ ‡§¨‡§ø‡§ù‡§®‡•á‡§∏ ‡§∏‡§Ç‡§ß‡•Ä ‡§Ü‡§™‡§≤‡•ç‡§Ø‡§æ ‡§∂‡§π‡§∞‡§æ‡§§ ‡§Ü‡§≤‡•Ä ‡§Ü‡§π‡•á. ‡§´‡§ï‡•ç‡§§ 10 ‡§Æ‡§ø‡§®‡§ø‡§ü‡•á ‡§µ‡•á‡§≥ ‡§¶‡•ç‡§Ø‡§æ, ‡§§‡•Å‡§Æ‡§ö‡•á ‡§Ü‡§Ø‡•Å‡§∑‡•ç‡§Ø ‡§¨‡§¶‡§≤‡•Ç ‡§∂‡§ï‡§§‡•á. üöÄ ‡§ï‡§ß‡•Ä ‡§≠‡•á‡§ü‡•Ç ‡§∂‡§ï‡§§‡•ã?</p>
                <button class="btn btn-sm btn-success w-100 mt-2" onclick="shareWhatsapp('msg3')"><i class="fab fa-whatsapp"></i> Share</button>
            </div>
        </div>

        <div id="view-list" class="section-view">
            <input type="text" id="searchInput" class="form-control mb-3 rounded-pill shadow-sm" placeholder="üîç Search Client...">
            <div id="clientListContainer"></div>
        </div>

        <div id="view-tools" class="section-view">
            <div class="card p-3 mb-3 text-center" onclick="generateReport('followup')">
                <h1 class="text-primary"><i class="fas fa-file-alt"></i></h1>
                <strong>Follow-up Diary (PDF)</strong>
            </div>
            <div class="card p-3 mb-3 text-center" onclick="generateReport('growth')">
                <h1 class="text-success"><i class="fas fa-chart-pie"></i></h1>
                <strong>Business Analysis (PDF)</strong>
            </div>
            <button class="btn btn-light w-100 border mb-2" onclick="downloadBackup()">üì• Backup Data</button>
            <label class="btn btn-light w-100 border">üì§ Restore Data <input type="file" hidden onchange="importBackup(this)"></label>
        </div>
    </div>

    <button class="fab-btn no-print" onclick="openAddModal()"><i class="fas fa-plus"></i></button>

    <div class="modal fade" id="addModal" tabindex="-1">
        <div class="modal-dialog modal-fullscreen-sm-down">
            <div class="modal-content">
                <div class="modal-header bg-light"><h5 class="modal-title fw-bold" style="color:var(--chakra)">New Entry</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form id="addForm">
                        <div class="row g-2">
                            <div class="col-12"><input type="text" class="form-control" id="cName" placeholder="Customer Name" required></div>
                            <div class="col-6"><input type="tel" class="form-control" id="cPhone" placeholder="Mobile"></div>
                            <div class="col-6"><input type="text" class="form-control" id="cDob" placeholder="Birthday (DD/MM)" onfocus="(this.type='date')"></div>
                            
                            <div class="col-6"><input type="date" class="form-control" id="cDate"></div>
                            <div class="col-6"><select class="form-select" id="cType"><option value="Hot">üî• Hot</option><option value="Warm">ü§î Warm</option><option value="Cold">‚ùÑÔ∏è Cold</option></select></div>
                            
                            <div class="col-12 bg-light p-2 rounded border">
                                <div class="input-group mb-2">
                                    <select class="form-select" id="cProd"><option value="">Product</option></select>
                                    <button type="button" class="btn btn-primary" onclick="addToCart()">Add</button>
                                </div>
                                <div id="cartList" class="small text-muted mb-1">No items</div>
                                <div class="fw-bold text-end">Total: ‚Çπ<span id="cartTotal">0</span></div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-success w-100 fw-bold" onclick="saveClient()">Save Data</button></div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="updateModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content shadow"><div class="modal-header border-0"><h6 class="modal-title fw-bold text-primary">Update Task</h6><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><input type="hidden" id="editClientId"><label class="small text-muted">Next Date:</label><input type="date" id="nextDateManual" class="form-control mb-3 border-primary"><textarea id="updateRemark" class="form-control mb-3" placeholder="Remark"></textarea><div class="d-grid gap-2"><button class="btn btn-primary" onclick="saveUpdate('reschedule')">üìÖ Reschedule</button><button class="btn btn-success" onclick="saveUpdate('complete')">‚úÖ Mark Done</button></div></div></div></div></div>

    <div id="printArea" class="print-area"></div>

    <div class="bottom-nav no-print">
        <a class="nav-item active" onclick="switchTab('view-home', this)"><i class="fas fa-home"></i>Home</a>
        <a class="nav-item" onclick="switchTab('view-promo', this)"><i class="fas fa-bullhorn"></i>Promo</a>
        <a class="nav-item" onclick="switchTab('view-list', this)"><i class="fas fa-users"></i>List</a>
        <a class="nav-item" onclick="switchTab('view-tools', this)"><i class="fas fa-cog"></i>Tools</a>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const SHEET_ID = "1eR5THz-4AV3HkfnNJ5Un48ksz0I0jrepJSED3qHFg6k";
        let currentCart = [];

        document.addEventListener('DOMContentLoaded', () => { loadData(); loadProducts(); updateTarget(); checkBirthdays(); });

        // --- 1. HOME & TASKS ---
        function loadData() {
            const taskContainer = document.getElementById('taskListContainer');
            const listContainer = document.getElementById('clientListContainer');
            taskContainer.innerHTML = ''; listContainer.innerHTML = '';
            
            const clients = JSON.parse(localStorage.getItem('rcmClients') || "[]");
            const today = new Date(); today.setHours(0,0,0,0);
            let totalSale = 0;

            clients.forEach(c => {
                totalSale += parseInt(c.amount || 0);
                
                // List
                listContainer.innerHTML += `<div class="client-card"><div><h6 class="m-0 fw-bold">${c.name}</h6><small class="text-muted">${c.product}</small></div><div class="text-end"><span class="text-success fw-bold">‚Çπ${c.amount}</span><br><a href="tel:${c.phone}"><i class="fas fa-phone"></i></a></div></div>`;

                // Tasks
                if(c.status === 'Pending') {
                    let nextDate = new Date(c.nextFollowUp);
                    let diff = Math.ceil((nextDate - today) / (1000 * 60 * 60 * 24));
                    let color = diff < 0 ? 'text-danger' : 'text-primary';
                    let status = diff < 0 ? `${Math.abs(diff)} Days Late` : (diff===0?'Today':`${diff} Days Left`);

                    taskContainer.innerHTML += `
                    <div class="task-card">
                        <div class="d-flex justify-content-between mb-2">
                            <div><h6 class="m-0 fw-bold text-dark">${c.name}</h6><small class="${color} fw-bold">${status}</small></div>
                            <div class="text-end"><a href="https://wa.me/91${c.phone}" class="btn btn-sm btn-success rounded-circle"><i class="fab fa-whatsapp"></i></a></div>
                        </div>
                        <button class="btn btn-sm btn-outline-primary w-100" onclick="openUpdateModal(${c.id})">Update Status</button>
                    </div>`;
                }
            });
            updateTargetUI(totalSale);
            if(taskContainer.innerHTML === '') taskContainer.innerHTML = "<div class='text-center text-muted mt-4'>No Pending Tasks!</div>";
        }

        // --- 2. TARGET METER LOGIC ---
        function setTarget() {
            let t = prompt("Set Monthly Target (‚Çπ):", localStorage.getItem('rcmTarget')||50000);
            if(t) { localStorage.setItem('rcmTarget', t); location.reload(); }
        }
        function updateTargetUI(current) {
            let target = parseInt(localStorage.getItem('rcmTarget') || 50000);
            let pct = Math.min((current / target) * 100, 100);
            document.getElementById('currentSale').innerText = current.toLocaleString();
            document.getElementById('targetAmount').innerText = target.toLocaleString();
            document.getElementById('targetBar').style.width = pct + "%";
            
            // Rank Badge
            let rank = "Beginner";
            if(current > 10000) rank = "‚≠ê Star";
            if(current > 50000) rank = "üíé Diamond";
            document.getElementById('rankBadge').innerText = rank;
        }

        // --- 3. BIRTHDAY CHECK ---
        function checkBirthdays() {
            let clients = JSON.parse(localStorage.getItem('rcmClients') || "[]");
            let today = new Date();
            let d = String(today.getDate()).padStart(2, '0');
            let m = String(today.getMonth() + 1).padStart(2, '0');
            let matchStr = `${d}-${m}`; // DD-MM format match from YYYY-MM-DD
            
            let bdayList = clients.filter(c => c.dob && c.dob.endsWith(matchStr));
            
            if(bdayList.length > 0) {
                document.getElementById('bdayAlert').style.display = 'flex';
                document.getElementById('bdayNames').innerText = bdayList.map(c => c.name).join(", ");
            }
        }

        // --- 4. PROMO & SHARE ---
        function copyText(id) {
            let text = document.getElementById(id).innerText;
            navigator.clipboard.writeText(text).then(() => alert("Copied!"));
        }
        function shareWhatsapp(id) {
            let text = document.getElementById(id).innerText;
            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
        }

        // --- 5. REPORT GENERATION ---
        function generateReport(type) {
            let clients = JSON.parse(localStorage.getItem('rcmClients') || "[]");
            let html = `<div style="text-align:center; margin-bottom:20px;"><h2>RCM Report</h2><p>${new Date().toLocaleString()}</p></div>`;
            
            if(type === 'followup') {
                html += `<h4>üìÖ Follow-up Diary</h4><table class="report-table"><thead><tr><th>Client</th><th>Product</th><th>Date</th><th>Status</th></tr></thead><tbody>`;
                clients.sort((a,b) => new Date(a.nextFollowUp) - new Date(b.nextFollowUp));
                clients.forEach(c => {
                    let st = c.status==='Done'?'Completed ‚úÖ':'Pending ‚è≥';
                    html += `<tr><td>${c.name}<br>${c.phone}</td><td>${c.product}</td><td>${c.nextFollowUp}</td><td>${st}</td></tr>`;
                });
                html += `</tbody></table>`;
            } else {
                let total = clients.reduce((s,c)=>s+parseInt(c.amount||0),0);
                html += `<h4>üìä Analysis</h4><p><strong>Total Clients:</strong> ${clients.length}</p><p><strong>Total Sales:</strong> ‚Çπ${total}</p>`;
                html += `<h4>üî• Hot Leads</h4><ul>` + clients.filter(c=>c.leadType==='Hot').map(c=>`<li>${c.name} - ${c.phone}</li>`).join('') + `</ul>`;
            }
            
            document.getElementById('printArea').innerHTML = html;
            window.print();
        }

        // --- CART & SAVE ---
        function loadProducts() { const dd=document.getElementById('cProd'); fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv`).then(r=>r.text()).then(c=>{dd.innerHTML='<option value="">Select</option>';c.split('\n').forEach(r=>{let x=r.replace(/"/g,'').split(',');if(x[0]&&x[0].length>2){let o=document.createElement('option');o.value=x[0];o.dataset.price=x[1]||0;o.text=x[0];dd.add(o);}});}).catch(()=>{}); }
        function addToCart() { const dd=document.getElementById('cProd'); if(!dd.value)return; currentCart.push({name:dd.value, price:parseInt(dd.options[dd.selectedIndex].dataset.price||0)}); renderCart(); }
        function renderCart() { let t=0; document.getElementById('cartList').innerHTML=currentCart.map(i=>{t+=i.price; return `<span>${i.name}</span>`}).join(", "); document.getElementById('cartTotal').innerText=t; }
        
        function saveClient() {
            let name = document.getElementById('cName').value; if(!name) return alert("Name needed");
            let amt = currentCart.reduce((s,i)=>s+i.price,0); let pStr = currentCart.map(i=>i.name).join(", ")||"No Product";
            let c = { id:Date.now(), name:name, phone:document.getElementById('cPhone').value, dob:document.getElementById('cDob').value, leadType:document.getElementById('cType').value, product:pStr, amount:amt, nextFollowUp:document.getElementById('cDate').value||new Date().toISOString().split('T')[0], status:'Pending', history:[] };
            let db = JSON.parse(localStorage.getItem('rcmClients')||"[]"); db.unshift(c); localStorage.setItem('rcmClients',JSON.stringify(db));
            bootstrap.Modal.getInstance(document.getElementById('addModal')).hide(); document.getElementById('addForm').reset(); currentCart=[]; loadData();
        }

        // --- UPDATE ---
        function openUpdateModal(id) { document.getElementById('editClientId').value=id; new bootstrap.Modal(document.getElementById('updateModal')).show(); }
        function saveUpdate(type) {
            let id = parseInt(document.getElementById('editClientId').value); let db=JSON.parse(localStorage.getItem('rcmClients')); let i=db.findIndex(x=>x.id===id);
            db[i].history.push({date:new Date().toLocaleDateString(), note:document.getElementById('updateRemark').value});
            if(type==='reschedule'){ let d=document.getElementById('nextDateManual').value; if(!d)return alert("Date needed"); db[i].nextFollowUp=d; db[i].status='Pending'; }
            else { db[i].status='Done'; }
            localStorage.setItem('rcmClients',JSON.stringify(db)); location.reload();
        }

        // --- UTILS ---
        function switchTab(v, e) { document.querySelectorAll('.section-view').forEach(x=>x.classList.remove('active-view')); document.getElementById(v).classList.add('active-view'); document.querySelectorAll('.nav-item').forEach(x=>x.classList.remove('active')); e.classList.add('active'); }
        function downloadBackup() { const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([localStorage.getItem('rcmClients')],{type:"application/json"})); a.download="Backup.json"; a.click(); }
        function importBackup(i) { const r=new FileReader(); r.onload=e=>{ if(confirm("Restore?")){localStorage.setItem('rcmClients', e.target.result); location.reload();} }; r.readAsText(i.files[0]); }
        document.getElementById('searchInput').addEventListener('input', loadData);
    </script>
</body>
</html>
